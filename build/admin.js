(()=>{"use strict";const e=window.React,t=window.wp.element,a=window.wp.i18n,l=window.wp.components,n=()=>`ls-${Math.random().toString(36).slice(2,8)}${Date.now().toString(36).slice(-4)}`,s=()=>{const e=Boolean(window?.chrome&&window.chrome.runtime);return{userAgent:"undefined"==typeof navigator?"":navigator.userAgent||"",hasChromeRuntime:e,suggestion:"Test in private browsing to isolate extensions."}},r=({debugEnabled:e=!1,prefix:t="[LeanStats]"}={})=>{const a=()=>"function"==typeof e?e():e,l=(e,l,n,s=!1)=>{(s||a())&&((e,a,l)=>{const n=`${t} ${a}`;console&&console.groupCollapsed?(console.groupCollapsed(n),console[e](l),console.groupEnd()):console[e](n,l)})(e,l,{time:"undefined"!=typeof performance&&performance.now?Number(performance.now().toFixed(2)):Date.now(),page:"undefined"!=typeof window&&window.location&&window.location.pathname||"",...n})};return{debug:(e,t={})=>l("debug",e,t),info:(e,t={})=>l("info",e,t),warn:(e,t={})=>l("warn",e,t),error:(e,n={})=>{a()?l("error",e,n,!0):console&&console.error&&console.error(`${t} ${e}`)},isDebugEnabled:()=>e}},i=({height:a,ariaLabel:l,children:n})=>{const{ref:s,hasSize:r}=(()=>{const e=(0,t.useRef)(null),[a,l]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{const t=e.current;if(!t)return;const a=()=>{const e=t.getBoundingClientRect(),a=e.width>0&&e.height>0;l(e=>e===a?e:a)};let n;return a(),window.ResizeObserver?(n=new ResizeObserver(()=>a()),n.observe(t)):window.addEventListener("resize",a),()=>{n?n.disconnect():window.removeEventListener("resize",a)}},[]),{ref:e,hasSize:a}})();return(0,e.createElement)("div",{ref:s,className:"ls-chart-frame","data-height":a,role:"img","aria-label":l},r?n:null)},o=["ls-skeleton__bar--w80","ls-skeleton__bar--w74","ls-skeleton__bar--w68","ls-skeleton__bar--w62","ls-skeleton__bar--w56","ls-skeleton__bar--w50"],c=({isLoading:t,error:n,isEmpty:s,emptyLabel:r,loadingLabel:i=(0,a.__)("Loading…","lean-stats"),skeletonRows:c=4})=>{if(t){const t=Array.from({length:c},(e,t)=>t);return(0,e.createElement)("div",{className:"ls-data-state","aria-live":"polite","aria-busy":"true"},(0,e.createElement)("div",{className:"ls-data-state__header"},(0,e.createElement)(l.Spinner,null),(0,e.createElement)("span",null,i)),(0,e.createElement)("div",{className:"ls-skeleton"},t.map(t=>(0,e.createElement)("div",{key:t,className:`ls-skeleton__bar ${o[Math.min(t,o.length-1)]}`}))))}return n?(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},n):s?(0,e.createElement)("p",{role:"status"},r):null},d=window.wp["dataviews/wp"],m=({title:t,children:a,...n})=>(0,e.createElement)(l.Card,{...n},t?(0,e.createElement)(l.CardHeader,null,(0,e.createElement)("strong",null,t)):null,(0,e.createElement)(l.CardBody,null,a)),_={table:{showMedia:!1}},g=[{label:"imported @wordpress/dataviews/wp",get:()=>d.DataViews},{label:"window.wp.dataviews.DataViews",get:()=>"undefined"==typeof window?null:window.wp?.dataviews?.DataViews},{label:'window.wp["dataviews/wp"].DataViews',get:()=>"undefined"==typeof window?null:window.wp?.["dataviews/wp"]?.DataViews},{label:"window.wp.dataviewsWp.DataViews",get:()=>"undefined"==typeof window?null:window.wp?.dataviewsWp?.DataViews}];let u=!1;const p=({title:t,data:n,fields:s,view:r,onChangeView:i,isLoading:o,error:d,emptyLabel:p,paginationInfo:b,getItemId:E,perPageSizes:w=[5,10,20]})=>{const h=(()=>{for(const e of g){const t=e.get();if(t)return t}return"undefined"==typeof window||u||(u=!0,console.warn(`Lean Stats: Data Views not found. Checked: ${g.map(e=>e.label).join(", ")}.`)),null})();return(0,e.createElement)(m,{title:t},(0,e.createElement)(c,{isLoading:o,error:d,isEmpty:!o&&!d&&0===n.length,emptyLabel:p,loadingLabel:(0,a.sprintf)((0,a.__)("Loading: %s","lean-stats"),t)}),!h&&!o&&!d&&(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,a.__)("Data views are unavailable. Update WordPress to enable the interactive table.","lean-stats")),h&&!o&&!d&&n.length>0&&(0,e.createElement)(h,{data:n,fields:s,view:r,onChangeView:i,paginationInfo:b,getItemId:E,defaultLayouts:_,search:!1,isLoading:o,config:{perPageSizes:w}}))},b=window.LeanStatsAdmin||null,E=()=>{var e;return Boolean(null!==(e=window.LEAN_STATS_DEBUG)&&void 0!==e?e:b?.settings?.debugEnabled)},w=[{name:"dashboard",title:(0,a.__)("Dashboard","lean-stats")},{name:"top-pages",title:(0,a.__)("Pages","lean-stats")},{name:"referrers",title:(0,a.__)("Referring sites","lean-stats")},{name:"not-found",title:(0,a.__)("Pages not found (404)","lean-stats")},{name:"search-terms",title:(0,a.__)("Internal searches","lean-stats")},{name:"geolocation",title:(0,a.__)("Geolocation","lean-stats")},{name:"settings",title:(0,a.__)("Settings","lean-stats")}],h={plugin_label:"",strict_mode:!1,respect_dnt_gpc:!0,url_strip_query:!0,url_query_allowlist:[],utm_allowlist:[],raw_logs_enabled:!1,raw_logs_retention_days:1,excluded_roles:[],excluded_paths:[],debug_enabled:!1,maxmind_api_key:""},y=["7d","30d","90d"],v=()=>`lean_stats_range_preset:${b?.currentUserId?String(b.currentUserId):"default"}`,f=e=>y.includes(e)?e:null,N=()=>{const e=(()=>{if("undefined"==typeof window)return null;const e=new URLSearchParams(window.location.search);return f(e.get("period")||e.get("range"))})(),[a,l]=(0,t.useState)(()=>e||(()=>{if("undefined"==typeof window||!window.localStorage)return null;try{return f(window.localStorage.getItem(v()))}catch(e){return null}})()||"30d"),[n,s]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{e&&!n||f(a)&&(e=>{if("undefined"!=typeof window&&window.localStorage)try{window.localStorage.setItem(v(),e)}catch(e){}})(a)},[a,e,n]),[a,e=>{l(e),s(!0)}]},L=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,k=e=>{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),l=new Date(a);switch(e){case"7d":l.setDate(l.getDate()-6);break;case"30d":default:l.setDate(l.getDate()-29);break;case"90d":l.setDate(l.getDate()-89)}return{start:L(l),end:L(a)}},S=(e,t,a)=>{const l=b?.restUrl?`${b.restUrl}`:"",n=new URL(`${null!=a?a:b?.settings?.restInternalNamespace||""}${e}`,l);return t&&Object.entries(t).forEach(([e,t])=>{null!=t&&""!==t&&n.searchParams.set(e,t)}),n.toString()},C=(e,l,s={})=>{const[i,o]=(0,t.useState)(null),[c,d]=(0,t.useState)(!0),[m,_]=(0,t.useState)(null),g=(0,t.useMemo)(()=>JSON.stringify(null!=l?l:{}),[l]),u=(0,t.useMemo)(()=>r({debugEnabled:E}),[]),{enabled:p=!0,namespace:w=b?.settings?.restInternalNamespace}=s;return(0,t.useEffect)(()=>{if(!p||!e)return d(!1),_(null),void o(null);let t=!0;const s=new AbortController,r=n();return(async()=>{if(!b?.restNonce||!b?.restUrl)return _((0,a.__)("Missing REST configuration.","lean-stats")),void d(!1);d(!0),_(null),u.debug("Loading admin data",{action:"admin.fetch",traceId:r,path:e,params:l});try{const n=await fetch(S(e,l,w),{signal:s.signal,headers:{"X-WP-Nonce":b.restNonce}});if(!n.ok)throw new Error((0,a.sprintf)((0,a.__)("API error (%s)","lean-stats"),n.status));const i=await n.json();t&&o(i),u.debug("Admin data received",{action:"admin.fetch.success",traceId:r,path:e})}catch(l){t&&"AbortError"!==l.name?(_(l.message||(0,a.__)("Loading error.","lean-stats")),u.error("Admin load error",{action:"admin.fetch.error",traceId:r,path:e,error:l?.message})):"AbortError"===l.name&&u.debug("Admin load cancelled",{action:"admin.fetch.abort",traceId:r,path:e})}finally{t&&d(!1)}})(),()=>{t=!1,s.abort()}},[e,g,p]),{data:i,isLoading:c,error:m}},x=e=>{const t={...h,...e||{}},a=Boolean(t.debug_enabled||t.raw_logs_enabled);return{...t,debug_enabled:a,raw_logs_enabled:a}},D=({debugEnabled:t})=>{const{data:n,isLoading:s,error:r}=C("/admin/raw-logs",{limit:50},{enabled:t}),i=n?.items||[];return t?(0,e.createElement)("div",{className:"ls-settings-logs"},(0,e.createElement)(c,{isLoading:s,error:r,isEmpty:!s&&!r&&0===i.length,emptyLabel:(0,a.__)("No raw logs available.","lean-stats"),loadingLabel:(0,a.__)("Loading raw logs…","lean-stats"),skeletonRows:4}),!s&&!r&&i.length>0&&(0,e.createElement)("table",{className:"widefat striped ls-settings-logs__table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("Date","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Page","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Referrer","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Device","lean-stats")))),(0,e.createElement)("tbody",null,i.map((t,l)=>{return(0,e.createElement)("tr",{key:`${t.timestamp_bucket}-${l}`},(0,e.createElement)("td",null,(n=t.timestamp_bucket)?new Date(1e3*n).toLocaleString():""),(0,e.createElement)("td",null,t.page_path),(0,e.createElement)("td",null,t.referrer_domain||(0,a.__)("Direct","lean-stats")),(0,e.createElement)("td",null,t.device_class||"-"));var n})))):(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,a.__)("Enable debug mode to display raw logs.","lean-stats"))},P=()=>{const{data:t,isLoading:n,error:s}=C("/admin/geolocation"),r=t?.location||null,i=r&&!r.error,o="maxmind-api"===r?.source?(0,a.__)("MaxMind API","lean-stats"):(0,a.__)("GeoLite2 (local)","lean-stats");return(0,e.createElement)(m,{title:(0,a.__)("Geolocation","lean-stats")},(0,e.createElement)(c,{isLoading:n,error:s,isEmpty:!n&&!s&&!i,emptyLabel:(0,a.__)("No geolocation data available.","lean-stats"),loadingLabel:(0,a.__)("Looking up location…","lean-stats"),skeletonRows:4}),!n&&!s&&r?.error&&(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},r.error),!n&&!s&&i&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("Location is derived from the current request IP and is not stored.","lean-stats")),(0,e.createElement)("table",{className:"widefat striped"},(0,e.createElement)("tbody",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("IP address","lean-stats")),(0,e.createElement)("td",null,r.ip)),(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("Country","lean-stats")),(0,e.createElement)("td",null,r.country||(0,a.__)("Unavailable","lean-stats"))),(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("Region","lean-stats")),(0,e.createElement)("td",null,r.region||(0,a.__)("Unavailable","lean-stats"))),(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("City","lean-stats")),(0,e.createElement)("td",null,r.city||(0,a.__)("Unavailable","lean-stats"))),(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("Source","lean-stats")),(0,e.createElement)("td",null,o))))))},M=({value:t,onChange:n})=>(0,e.createElement)(l.Card,{className:"ls-overview__summary-card ls-overview__summary-card--filter"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Period","lean-stats"),value:t,options:[{label:(0,a.__)("7 days","lean-stats"),value:"7d"},{label:(0,a.__)("30 days","lean-stats"),value:"30d"},{label:(0,a.__)("90 days","lean-stats"),value:"90d"}],onChange:n,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}))),I=()=>{const{data:s,isLoading:i,error:o}=C("/admin/settings"),[d,_]=(0,t.useState)(h),[g,u]=(0,t.useState)(""),[p,w]=(0,t.useState)(""),[y,v]=(0,t.useState)(""),[f,N]=(0,t.useState)(!1),[L,k]=(0,t.useState)(null),[P,M]=(0,t.useState)(!1),[I,B]=(0,t.useState)(!1),[T,R]=(0,t.useState)(null),A=(0,t.useMemo)(()=>r({debugEnabled:E}),[]),$=Boolean(d.debug_enabled),F=(0,t.useMemo)(()=>[(0,a.__)("Aggregated page views by URL path.","lean-stats"),(0,a.__)("Aggregated referrer domains.","lean-stats"),(0,a.__)("Aggregated device class totals.","lean-stats"),(0,a.__)("Aggregated 404 paths.","lean-stats"),(0,a.__)("Aggregated on-site search terms.","lean-stats"),(0,a.__)("Aggregated UTM campaign parameters (when allowlisted).","lean-stats"),(0,a.__)("Raw log snapshots (timestamp, page path, referrer, device) when debug mode is enabled.","lean-stats")],[]),U=(0,t.useMemo)(()=>{const e=[];return d.respect_dnt_gpc||e.push((0,a.__)("Tracking continues even when browsers send DNT or GPC.","lean-stats")),d.url_strip_query||e.push((0,a.__)("Full query strings remain in stored page paths.","lean-stats")),d.raw_logs_enabled&&e.push((0,a.__)("Raw logs store granular view details while debug mode is enabled.","lean-stats")),d.raw_logs_retention_days>30&&e.push((0,a.__)("Raw log retention exceeds 30 days.","lean-stats")),d.utm_allowlist?.length&&e.push((0,a.__)("Allowlisted UTM parameters are stored in aggregated reports.","lean-stats")),e},[d]);(0,t.useEffect)(()=>{if(s?.settings){const e=x(s.settings);_(e),u(e.url_query_allowlist.join(", ")),w(e.utm_allowlist.join(", ")),v(e.excluded_paths.join("\n")),window.LEAN_STATS_DEBUG=Boolean(e.debug_enabled)}},[s]);const H=async()=>{if(!b?.restNonce||!b?.restUrl)return void k({status:"error",message:(0,a.__)("Missing REST configuration.","lean-stats")});N(!0),k(null);const e=n();A.info("Saving settings",{action:"settings.save",traceId:e});try{const t=await fetch(S("/admin/settings"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":b.restNonce},body:JSON.stringify(d)});if(!t.ok)throw new Error((0,a.sprintf)((0,a.__)("API error (%s)","lean-stats"),t.status));const l=await t.json();if(l?.settings){const e=x(l.settings);_(e),u(e.url_query_allowlist.join(", ")),w(e.utm_allowlist.join(", ")),v(e.excluded_paths.join("\n")),window.LEAN_STATS_DEBUG=Boolean(e.debug_enabled)}k({status:"success",message:(0,a.__)("Settings saved.","lean-stats")}),A.info("Settings saved",{action:"settings.save.success",traceId:e})}catch(t){k({status:"error",message:t.message||(0,a.__)("Error while saving.","lean-stats")}),A.error("Settings save error",{action:"settings.save.error",traceId:e,error:t?.message})}finally{N(!1)}},K=async()=>{if(!b?.restNonce||!b?.restUrl)return void R({status:"error",message:(0,a.__)("Missing REST configuration.","lean-stats")});B(!0),R(null);const e=n();A.info("Purging analytics data",{action:"settings.purge",traceId:e});try{const t=await fetch(S("/admin/purge-data"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":b.restNonce}});if(!t.ok)throw new Error((0,a.sprintf)((0,a.__)("API error (%s)","lean-stats"),t.status));await t.json(),R({status:"success",message:(0,a.__)("Analytics data purged.","lean-stats")}),A.info("Analytics data purged",{action:"settings.purge.success",traceId:e})}catch(t){R({status:"error",message:t.message||(0,a.__)("Error while purging.","lean-stats")}),A.error("Purge error",{action:"settings.purge.error",traceId:e,error:t?.message})}finally{B(!1),M(!1)}},V=b?.roles||[],j=[{name:"general",title:(0,a.__)("General","lean-stats")},...$?[{name:"logs",title:(0,a.__)("Logs","lean-stats")}]:[]];return(0,e.createElement)(m,{title:(0,a.__)("Settings","lean-stats")},(0,e.createElement)(c,{isLoading:i,error:o,isEmpty:!1,emptyLabel:"",loadingLabel:(0,a.__)("Loading settings…","lean-stats"),skeletonRows:6}),!i&&!o&&(0,e.createElement)(l.TabPanel,{tabs:j},t=>"logs"===t.name?(0,e.createElement)(D,{debugEnabled:$}):(0,e.createElement)("div",{className:"ls-settings-form"},L&&(0,e.createElement)(l.Notice,{status:L.status,isDismissible:!1},L.message),T&&(0,e.createElement)(l.Notice,{status:T.status,isDismissible:!1},T.message),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("General","lean-stats")),(0,e.createElement)(l.TextControl,{label:(0,a.__)("Plugin name (menu and dashboard)","lean-stats"),help:(0,a.__)('Leave blank to use "Lean Stats".',"lean-stats"),value:d.plugin_label,onChange:e=>_(t=>({...t,plugin_label:e}))}),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Strict mode","lean-stats"),help:(0,a.__)("Ignore tracking for logged-in users.","lean-stats"),checked:d.strict_mode,onChange:e=>_(t=>({...t,strict_mode:e}))}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Geolocation","lean-stats")),(0,e.createElement)(l.TextControl,{label:(0,a.__)("MaxMind API key","lean-stats"),type:"password",help:(0,a.__)("Format: AccountID:LicenseKey. Leave blank to use the local GeoLite2 database.","lean-stats"),value:d.maxmind_api_key,onChange:e=>_(t=>({...t,maxmind_api_key:e}))}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Privacy & consent","lean-stats")),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Respect DNT / GPC","lean-stats"),help:(0,a.__)("Ignore tracking if the browser sends DNT or GPC.","lean-stats"),checked:d.respect_dnt_gpc,onChange:e=>_(t=>({...t,respect_dnt_gpc:e}))}),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Debug mode","lean-stats"),help:(0,a.__)("Enables detailed console logs and raw log capture.","lean-stats"),checked:d.debug_enabled,onChange:e=>_(t=>({...t,debug_enabled:e,raw_logs_enabled:e}))}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("Retention window (days)","lean-stats"),type:"number",min:1,max:365,value:String(d.raw_logs_retention_days),help:(0,a.__)("Raw logs purge automatically after the configured window.","lean-stats"),onChange:e=>{const t=Number.parseInt(e,10);_(e=>({...e,raw_logs_retention_days:Number.isNaN(t)?e.raw_logs_retention_days:t}))}}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("URL cleaning","lean-stats")),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Strip query parameters","lean-stats"),help:(0,a.__)("Remove query parameters from tracked URLs.","lean-stats"),checked:d.url_strip_query,onChange:e=>_(t=>({...t,url_strip_query:e}))}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("Query parameter allowlist","lean-stats"),help:(0,a.__)("Comma-separated list (e.g., utm_source, utm_campaign).","lean-stats"),value:g,onChange:e=>{u(e);const t=e.split(",").map(e=>e.trim()).filter(Boolean);_(e=>({...e,url_query_allowlist:t}))}}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("UTM allowlist","lean-stats"),help:(0,a.__)("Comma-separated list of UTM parameters to aggregate (e.g., utm_source, utm_medium).","lean-stats"),value:p,onChange:e=>{w(e);const t=e.split(",").map(e=>e.trim()).filter(Boolean);_(e=>({...e,utm_allowlist:t}))}}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Exclusions","lean-stats")),(0,e.createElement)(l.TextareaControl,{label:(0,a.__)("Excluded paths","lean-stats"),help:(0,a.__)("One per line or comma-separated (e.g., /privacy, /account).","lean-stats"),value:y,onChange:e=>{v(e);const t=e.split(/[\n,]+/).map(e=>e.trim()).filter(Boolean);_(e=>({...e,excluded_paths:t}))}}),(0,e.createElement)("div",null,(0,e.createElement)("p",{className:"ls-settings-roles__title"},(0,a.__)("Role exclusions","lean-stats")),(0,e.createElement)("div",{className:"ls-settings-roles__list"},0===V.length&&(0,e.createElement)("p",null,(0,a.__)("No roles available.","lean-stats")),V.map(t=>(0,e.createElement)(l.CheckboxControl,{key:t.key,label:t.label,checked:d.excluded_roles.includes(t.key),onChange:e=>{_(a=>{const l=new Set(a.excluded_roles);return e?l.add(t.key):l.delete(t.key),{...a,excluded_roles:Array.from(l)}})}})))))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Privacy checklist","lean-stats")),(0,e.createElement)("ul",{className:"ls-settings-privacy__list"},F.map(t=>(0,e.createElement)("li",{key:t},t))),U.length>0&&(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,e.createElement)("p",null,(0,a.__)("Review these privacy risks:","lean-stats")),(0,e.createElement)("ul",{className:"ls-settings-privacy__warnings"},U.map(t=>(0,e.createElement)("li",{key:t},t)))))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Data management","lean-stats")),(0,e.createElement)("p",null,(0,a.__)("Remove all aggregated analytics and raw log entries.","lean-stats")),(0,e.createElement)(l.Button,{variant:"secondary",isDestructive:!0,onClick:()=>M(!0)},(0,a.__)("Purge analytics data","lean-stats")))),(0,e.createElement)(l.Button,{variant:"primary",isBusy:f,onClick:H,"aria-label":(0,a.__)("Save settings","lean-stats")},(0,a.__)("Save","lean-stats")),P&&(0,e.createElement)(l.Modal,{title:(0,a.__)("Confirm data purge","lean-stats"),onRequestClose:()=>M(!1)},(0,e.createElement)("p",null,(0,a.__)("This action permanently removes all stored analytics and raw logs. Settings remain unchanged.","lean-stats")),(0,e.createElement)("div",{className:"ls-settings-modal__actions"},(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>M(!1)},(0,a.__)("Cancel","lean-stats")),(0,e.createElement)(l.Button,{variant:"primary",isDestructive:!0,isBusy:I,onClick:K},(0,a.__)("Purge now","lean-stats")))))))},B=({range:t})=>{var n;const{data:s,isLoading:r,error:i}=C("/overview",t,{namespace:b?.settings?.restNamespace}),o=s?.overview||null,d=!r&&!i&&!o;if(r||i||d)return(0,e.createElement)(l.Card,{className:"ls-overview__summary-card ls-overview__summary-card--status"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)(c,{isLoading:r,error:i,isEmpty:d,emptyLabel:(0,a.__)("No overview data available.","lean-stats"),loadingLabel:(0,a.__)("Loading overview…","lean-stats"),skeletonRows:3})));const m=(0,a.__)("Number of anonymous sessions over the selected period. The same person can generate multiple visits.","lean-stats"),_=(0,a.__)("Anonymous sessions aggregated over the selected period.","lean-stats"),g="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(max-width: 600px)").matches?_:m,u=[{label:(0,a.__)("Visits","lean-stats"),value:null!==(n=o.visits)&&void 0!==n?n:0,icon:"visibility",tooltip:g},{label:(0,a.__)("Page views","lean-stats"),value:o.pageViews,icon:"chart-bar"},{label:(0,a.__)("Referring sites","lean-stats"),value:o.uniqueReferrers,icon:"admin-links"},{label:(0,a.__)("Pages not found (404)","lean-stats"),value:o.notFoundHits,icon:"warning"},{label:(0,a.__)("Internal searches","lean-stats"),value:o.searchHits,icon:"search"}];return(0,e.createElement)(e.Fragment,null,u.map(t=>(0,e.createElement)(l.Card,{key:t.label,className:"ls-overview__summary-card"},(0,e.createElement)(l.CardBody,{className:"ls-kpi-card__body"},(0,e.createElement)("span",{className:`dashicons dashicons-${t.icon} ls-kpi-card__icon`,"aria-hidden":"true"}),(0,e.createElement)("div",{className:"ls-kpi-card__content"},(0,e.createElement)("p",{className:"ls-kpi-card__label"},(0,e.createElement)("span",{className:"ls-kpi-card__label-text"},t.label),t.tooltip?(0,e.createElement)(l.Tooltip,{text:t.tooltip},(0,e.createElement)(l.Button,{className:"ls-kpi-card__tooltip-button",variant:"tertiary",isSmall:!0,"aria-label":t.tooltip},(0,e.createElement)("span",{className:"dashicons dashicons-info-outline","aria-hidden":"true"}))):null),(0,e.createElement)("strong",{className:"ls-kpi-card__value"},t.value))))))},T=({range:l})=>{const{data:n,isLoading:s,error:r}=C("/admin/timeseries/day",l),o=n?.items||[],d=(0,t.useMemo)(()=>(e=>{const t=e.reduce((e,t)=>Math.max(e,t.hits),0),a=Math.max(576,1),l=Math.max(176,1),n=Math.max(e.length-1,1),s=e.map((e,s)=>({x:32+a*s/n,y:208-(t?e.hits/t*l:0),label:e.bucket,hits:e.hits})),r=s.map((e,t)=>`${0===t?"M":"L"} ${e.x} ${e.y}`).join(" ");return{points:s,path:r,maxHits:t,width:640,height:240,padding:32}})(o),[o]);return(0,e.createElement)(m,{title:(0,a.__)("Daily page views","lean-stats")},(0,e.createElement)(c,{isLoading:s,error:r,isEmpty:!s&&!r&&0===o.length,emptyLabel:(0,a.__)("No data available for this period.","lean-stats"),loadingLabel:(0,a.__)("Loading chart…","lean-stats")}),!s&&!r&&o.length>0&&(0,e.createElement)("div",{className:"ls-timeseries"},(0,e.createElement)(i,{height:240,ariaLabel:(0,a.__)("Daily page views line chart","lean-stats")},(0,e.createElement)("svg",{viewBox:`0 0 ${d.width} ${d.height}`,className:"ls-timeseries__svg",role:"img","aria-label":(0,a.__)("Daily page views line chart","lean-stats")},(0,e.createElement)("rect",{x:"0",y:"0",width:d.width,height:d.height,className:"ls-timeseries__bg"}),(0,e.createElement)("line",{x1:d.padding,y1:d.padding,x2:d.padding,y2:d.height-d.padding,className:"ls-timeseries__axis"}),(0,e.createElement)("line",{x1:d.padding,y1:d.height-d.padding,x2:d.width-d.padding,y2:d.height-d.padding,className:"ls-timeseries__axis"}),(0,e.createElement)("path",{d:d.path,className:"ls-timeseries__line"}),d.points.map(t=>(0,e.createElement)("circle",{key:`${t.label}-${t.hits}`,cx:t.x,cy:t.y,r:"3",className:"ls-timeseries__point"})))),(0,e.createElement)("table",{className:"widefat striped ls-timeseries__table","aria-label":(0,a.__)("Daily series table","lean-stats")},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("Date","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Page views","lean-stats")))),(0,e.createElement)("tbody",null,o.map(t=>(0,e.createElement)("tr",{key:t.bucket},(0,e.createElement)("td",null,t.bucket),(0,e.createElement)("td",null,t.hits)))))))},R=({title:n,labelHeader:s,range:r,endpoint:i,emptyLabel:o,labelFallback:d,metricLabel:_=(0,a.__)("Page views","lean-stats"),metricKey:g="hits",metricValueKey:u="hits"})=>{const[p,E]=(0,t.useState)(1),[w,h]=(0,t.useState)(10),[y,v]=(0,t.useState)(g),[f,N]=(0,t.useState)("desc");(0,t.useEffect)(()=>{E(1)},[r.start,r.end]),(0,t.useEffect)(()=>{v(g),N("desc")},[g]);const{data:L,isLoading:k,error:S}=C(i,{...r,page:p,per_page:w,orderby:y,order:f},{namespace:b?.settings?.restNamespace}),x=L?.items||[],D=L?.pagination||{},P=D.totalPages||1,M=D.totalItems||x.length;(0,t.useEffect)(()=>{!k&&!S&&P&&p>P&&E(P)},[P,p,k,S]);const I=p>1,B=p<P,T="asc"===f?(0,a.__)("Ascending","lean-stats"):(0,a.__)("Descending","lean-stats"),R=(0,a.sprintf)((0,a.__)("%s label","lean-stats"),s),A=(0,a.sprintf)((0,a.__)("Toggle sort order: %s","lean-stats"),T),$=(0,a.sprintf)((0,a.__)("Table: %s","lean-stats"),n),F=x.map((e,t)=>{var a;return{key:`${e.label||d}-${t}`,label:e.label||d,value:null!==(a=e?.[u])&&void 0!==a?a:0}});return(0,e.createElement)(m,{title:n},(0,e.createElement)("div",{className:"ls-table-controls"},(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Sort by","lean-stats"),value:y,options:[{label:_,value:g},{label:R,value:"label"}],onChange:e=>{v(e),E(1)},__nextHasNoMarginBottom:!0}),(0,e.createElement)(l.Button,{variant:"secondary",icon:"asc"===f?"arrow-up-alt2":"arrow-down-alt2",onClick:()=>{N("asc"===f?"desc":"asc"),E(1)},"aria-label":A},T),(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Rows","lean-stats"),value:String(w),options:[{label:"5",value:"5"},{label:"10",value:"10"},{label:"20",value:"20"}],onChange:e=>{h(Number(e)),E(1)},__nextHasNoMarginBottom:!0})),(0,e.createElement)(c,{isLoading:k,error:S,isEmpty:!k&&!S&&0===F.length,emptyLabel:o,loadingLabel:(0,a.sprintf)((0,a.__)("Loading: %s","lean-stats"),n)}),!k&&!S&&F.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("table",{className:"ls-report-table","aria-label":$},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{scope:"col"},s),(0,e.createElement)("th",{scope:"col"},_))),(0,e.createElement)("tbody",null,F.map(t=>(0,e.createElement)("tr",{key:t.key},(0,e.createElement)("td",null,t.label),(0,e.createElement)("td",null,t.value))))),(0,e.createElement)(l.Flex,{className:"ls-table-pagination",justify:"space-between",align:"center"},(0,e.createElement)(l.FlexItem,null,(0,e.createElement)(l.ButtonGroup,null,(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>E(e=>Math.max(e-1,1)),disabled:!I,"aria-label":(0,a.__)("Previous page","lean-stats")},(0,a.__)("Previous","lean-stats")),(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>E(e=>Math.min(e+1,P)),disabled:!B,"aria-label":(0,a.__)("Next page","lean-stats")},(0,a.__)("Next","lean-stats")))),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},(0,a.sprintf)((0,a.__)("Page %1$d of %2$d","lean-stats"),p,P)),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},(0,a.sprintf)((0,a.__)("%s items","lean-stats"),M)))))},A=({title:l,labelHeader:n,range:s,endpoint:r,emptyLabel:i,labelFallback:o,metricLabel:c=(0,a.__)("Page views","lean-stats"),metricKey:d="hits",metricValueKey:m="hits"})=>{var _,g,u,E;const[w,h]=(0,t.useState)(()=>(({metricKey:e,perPage:t=10})=>({type:"table",search:"",page:1,perPage:t,sort:{field:e,direction:"desc"},fields:["label",e],layout:{}}))({metricKey:d}));(0,t.useEffect)(()=>{h(e=>({...e,page:1}))},[s.start,s.end]),(0,t.useEffect)(()=>{h(e=>({...e,sort:{field:d,direction:"desc"},fields:["label",d]}))},[d]);const y=null!==(_=w.page)&&void 0!==_?_:1,v=null!==(g=w.perPage)&&void 0!==g?g:10,f=null!==(u=w.sort?.field)&&void 0!==u?u:d,N=null!==(E=w.sort?.direction)&&void 0!==E?E:"desc",{data:L,isLoading:k,error:S}=C(r,{...s,page:y,per_page:v,orderby:f,order:N},{namespace:b?.settings?.restNamespace}),x=L?.items||[],D=L?.pagination||{},P=D.totalPages||1,M=D.totalItems||x.length;(0,t.useEffect)(()=>{!k&&!S&&P&&y>P&&h(e=>({...e,page:P}))},[P,y,k,S]);const I=(0,t.useMemo)(()=>(({labelHeader:e,metricLabel:t,metricKey:a})=>[{id:"label",type:"text",label:e,enableHiding:!1},{id:a,type:"integer",label:t,enableHiding:!1}])({labelHeader:n,metricLabel:c,metricKey:d}),[n,c,d]),B=(0,t.useMemo)(()=>(({items:e,labelFallback:t,metricKey:a,metricValueKey:l})=>e.map((e,n)=>{var s;return{id:`${e.label||t}-${n}`,label:e.label||t,[a]:null!==(s=e?.[l])&&void 0!==s?s:0}}))({items:x,labelFallback:o,metricKey:d,metricValueKey:m}),[x,o,d,m]),T=(0,t.useMemo)(()=>({totalItems:M,totalPages:P}),[M,P]);return(0,e.createElement)(p,{title:l,data:B,fields:I,view:w,onChangeView:h,isLoading:k,error:S,emptyLabel:i,paginationInfo:T,getItemId:e=>e.id})},$=({range:n})=>{const[s,r]=(0,t.useState)(1),[i,o]=(0,t.useState)(10),[d,_]=(0,t.useState)("hits"),[g,u]=(0,t.useState)("desc");(0,t.useEffect)(()=>{r(1)},[n.start,n.end]);const{data:p,isLoading:E,error:w}=C("/referrer-sources",{...n,page:s,per_page:i,orderby:d,order:g},{namespace:b?.settings?.restNamespace}),h=p?.items||[],y=p?.pagination||{},v=y.totalPages||1,f=y.totalItems||h.length;(0,t.useEffect)(()=>{!E&&!w&&v&&s>v&&r(v)},[v,s,E,w]);const N=s>1,L=s<v,k="asc"===g?(0,a.__)("Ascending","lean-stats"):(0,a.__)("Descending","lean-stats"),S=(0,a.sprintf)((0,a.__)("Toggle sort order: %s","lean-stats"),k),x=(0,a.__)("Table: Referrer sources","lean-stats"),D=h.map((e,t)=>{const l=e.referrer_domain||(0,a.__)("Direct","lean-stats"),n=e.referrer_domain?(0,a.__)("Referrer","lean-stats"):(0,a.__)("Direct","lean-stats");return{key:`${l}-${e.source_category||n}-${t}`,referrer:l,category:e.source_category||n,hits:e.hits}});return(0,e.createElement)(m,{title:(0,a.__)("Referrer sources","lean-stats")},(0,e.createElement)("div",{className:"ls-table-controls"},(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Sort by","lean-stats"),value:d,options:[{label:(0,a.__)("Page views","lean-stats"),value:"hits"},{label:(0,a.__)("Referrer","lean-stats"),value:"referrer"},{label:(0,a.__)("Source category","lean-stats"),value:"category"}],onChange:e=>{_(e),r(1)},__nextHasNoMarginBottom:!0}),(0,e.createElement)(l.Button,{variant:"secondary",icon:"asc"===g?"arrow-up-alt2":"arrow-down-alt2",onClick:()=>{u("asc"===g?"desc":"asc"),r(1)},"aria-label":S},k),(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Rows","lean-stats"),value:String(i),options:[{label:"5",value:"5"},{label:"10",value:"10"},{label:"20",value:"20"}],onChange:e=>{o(Number(e)),r(1)},__nextHasNoMarginBottom:!0})),(0,e.createElement)(c,{isLoading:E,error:w,isEmpty:!E&&!w&&0===D.length,emptyLabel:(0,a.__)("No referrer data available.","lean-stats"),loadingLabel:(0,a.__)("Loading referrer sources…","lean-stats")}),!E&&!w&&D.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("table",{className:"ls-report-table","aria-label":x},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{scope:"col"},(0,a.__)("Referrer","lean-stats")),(0,e.createElement)("th",{scope:"col"},(0,a.__)("Source category","lean-stats")),(0,e.createElement)("th",{scope:"col"},(0,a.__)("Page views","lean-stats")))),(0,e.createElement)("tbody",null,D.map(t=>(0,e.createElement)("tr",{key:t.key},(0,e.createElement)("td",null,t.referrer),(0,e.createElement)("td",null,t.category),(0,e.createElement)("td",null,t.hits))))),(0,e.createElement)(l.Flex,{className:"ls-table-pagination",justify:"space-between",align:"center"},(0,e.createElement)(l.FlexItem,null,(0,e.createElement)(l.ButtonGroup,null,(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>r(e=>Math.max(e-1,1)),disabled:!N,"aria-label":(0,a.__)("Previous page","lean-stats")},(0,a.__)("Previous","lean-stats")),(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>r(e=>Math.min(e+1,v)),disabled:!L,"aria-label":(0,a.__)("Next page","lean-stats")},(0,a.__)("Next","lean-stats")))),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},(0,a.sprintf)((0,a.__)("Page %1$d of %2$d","lean-stats"),s,v)),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},(0,a.sprintf)((0,a.__)("%s items","lean-stats"),f)))))},F=()=>(0,e.createElement)(l.Notice,{status:"info",isDismissible:!1},(0,a.__)("All data is aggregated and contains no per-visitor details. Entry and exit pages are approximations based on referrer data.","lean-stats")),U=({title:a,endpoint:l,labelHeader:n,emptyLabel:s,labelFallback:r,metricLabel:i,metricKey:o,metricValueKey:c})=>{const[d,m]=N(),_=(0,t.useMemo)(()=>k(d),[d]);return(0,e.createElement)("div",{className:"ls-report-panel"},(0,e.createElement)("div",{className:"ls-report-panel__header"},(0,e.createElement)(M,{value:d,onChange:m}),(0,e.createElement)(F,null)),(0,e.createElement)(R,{title:a,labelHeader:n,range:_,endpoint:l,emptyLabel:s,labelFallback:r,metricLabel:i,metricKey:o,metricValueKey:c}))},H=({title:a,endpoint:l,labelHeader:n,emptyLabel:s,labelFallback:r,metricLabel:i,metricKey:o,metricValueKey:c})=>{const[d,m]=N(),_=(0,t.useMemo)(()=>k(d),[d]);return(0,e.createElement)("div",{className:"ls-report-panel"},(0,e.createElement)("div",{className:"ls-report-panel__header"},(0,e.createElement)(M,{value:d,onChange:m}),(0,e.createElement)(F,null)),(0,e.createElement)(A,{title:a,labelHeader:n,range:_,endpoint:l,emptyLabel:s,labelFallback:r,metricLabel:i,metricKey:o,metricValueKey:c}))},K=()=>{const t=[{name:"top-pages",title:(0,a.__)("Pages","lean-stats")},{name:"entry-pages",title:(0,a.__)("Entry pages","lean-stats")},{name:"exit-pages",title:(0,a.__)("Exit pages","lean-stats")}];return(0,e.createElement)(l.TabPanel,{className:"ls-pages-tabs",tabs:t},t=>"entry-pages"===t.name?(0,e.createElement)(q,null):"exit-pages"===t.name?(0,e.createElement)(z,null):(0,e.createElement)(V,null))},V=()=>(0,e.createElement)(H,{title:(0,a.__)("Top pages","lean-stats"),labelHeader:(0,a.__)("Page","lean-stats"),endpoint:"/top-pages",emptyLabel:(0,a.__)("No popular pages available.","lean-stats"),labelFallback:"/"}),j=()=>(0,e.createElement)(U,{title:(0,a.__)("Top 404s","lean-stats"),labelHeader:(0,a.__)("Missing page","lean-stats"),endpoint:"/404s",emptyLabel:(0,a.__)("No missing pages available.","lean-stats"),labelFallback:"/"}),G=()=>(0,e.createElement)(U,{title:(0,a.__)("Search terms","lean-stats"),labelHeader:(0,a.__)("Search term","lean-stats"),endpoint:"/search-terms",emptyLabel:(0,a.__)("No search terms available.","lean-stats"),labelFallback:(0,a.__)("Unknown","lean-stats")}),q=()=>(0,e.createElement)(U,{title:(0,a.__)("Entry pages (approx.)","lean-stats"),labelHeader:(0,a.__)("Entry page","lean-stats"),endpoint:"/entry-pages",emptyLabel:(0,a.__)("No entry pages available.","lean-stats"),labelFallback:"/",metricLabel:(0,a.__)("Entries (approx.)","lean-stats"),metricKey:"entries",metricValueKey:"entries"}),z=()=>(0,e.createElement)(U,{title:(0,a.__)("Exit pages (approx.)","lean-stats"),labelHeader:(0,a.__)("Exit page","lean-stats"),endpoint:"/exit-pages",emptyLabel:(0,a.__)("No exit pages available.","lean-stats"),labelFallback:"/",metricLabel:(0,a.__)("Exits (approx.)","lean-stats"),metricKey:"exits",metricValueKey:"exits"}),O=()=>{const[a,l]=N(),n=(0,t.useMemo)(()=>k(a),[a]);return(0,e.createElement)("div",{className:"ls-report-panel"},(0,e.createElement)("div",{className:"ls-report-panel__header"},(0,e.createElement)(M,{value:a,onChange:l}),(0,e.createElement)(F,null)),(0,e.createElement)($,{range:n}))},W=({range:t})=>{const{data:l,isLoading:n,error:s}=C("/admin/device-split",t),r=(l?.items||[]).map(e=>({...e,label:e.label?e.label.charAt(0).toUpperCase()+e.label.slice(1):(0,a.__)("Unknown","lean-stats")})),i=r.reduce((e,t)=>Math.max(e,t.hits),0);return(0,e.createElement)(m,{title:(0,a.__)("Device page views","lean-stats")},(0,e.createElement)(c,{isLoading:n,error:s,isEmpty:!n&&!s&&0===r.length,emptyLabel:(0,a.__)("No device data available.","lean-stats"),loadingLabel:(0,a.__)("Loading device breakdown…","lean-stats")}),!n&&!s&&r.length>0&&(0,e.createElement)("div",{className:"ls-device-breakdown"},r.map(t=>{const l=i?Math.round(t.hits/i*100):0;return(0,e.createElement)("div",{key:t.label,className:"ls-device-breakdown__row"},(0,e.createElement)("div",{className:"ls-device-breakdown__label"},t.label),(0,e.createElement)("div",{className:"ls-device-breakdown__bar","aria-hidden":"true"},(0,e.createElement)("div",{className:"ls-device-breakdown__bar-fill",style:{width:`${l}%`}})),(0,e.createElement)("div",{className:"ls-device-breakdown__value"},(0,a.sprintf)((0,a.__)("%s views","lean-stats"),t.hits)))})))},X=()=>{const[l,n]=N(),s=(0,t.useMemo)(()=>k(l),[l]);return(0,e.createElement)("div",{className:"ls-overview"},(0,e.createElement)("div",{className:"ls-overview__summary"},(0,e.createElement)(M,{value:l,onChange:n}),(0,e.createElement)(B,{range:s})),(0,e.createElement)(T,{range:s}),(0,e.createElement)("div",{className:"ls-overview__grid"},(0,e.createElement)(A,{title:(0,a.__)("Top pages","lean-stats"),labelHeader:(0,a.__)("Page","lean-stats"),range:s,endpoint:"/top-pages",emptyLabel:(0,a.__)("No popular pages available.","lean-stats"),labelFallback:"/"}),(0,e.createElement)(R,{title:(0,a.__)("Top referrers","lean-stats"),labelHeader:(0,a.__)("Referrer","lean-stats"),range:s,endpoint:"/referrers",emptyLabel:(0,a.__)("No referrers available.","lean-stats"),labelFallback:(0,a.__)("Direct","lean-stats")}),(0,e.createElement)(W,{range:s})))},J=document.getElementById("lean-stats-admin");J&&(0,t.render)((0,e.createElement)(()=>{var i;if(!b)return(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},(0,a.__)("Missing admin configuration.","lean-stats"));const o=(e=>{if(!Array.isArray(e))return w;const t=e.map(e=>({name:e?.name||"",title:e?.title||e?.name||""})).filter(e=>e.name);return t.length>0?t:w})(b?.panels),c=b?.currentPanel||"dashboard",d=(e=>{const t={dashboard:X,"top-pages":K,referrers:O,"not-found":j,"search-terms":G,geolocation:P,settings:I};return t[e]?t[e]:(window.LeanStatsAdminPanels||{})[e]||null})(c),m=((e,t)=>{const l=t.find(t=>t.name===e);return l?.title||(0,a.__)("Lean Stats","lean-stats")})(c,o),_=b?.settings?.pluginLabel||(0,a.__)("Lean Stats","lean-stats"),g=Boolean(null!==(i=window.LEAN_STATS_DEBUG)&&void 0!==i?i:b?.settings?.debugEnabled),u=(0,t.useMemo)(()=>r({debugEnabled:g}),[g]);return(0,t.useEffect)(()=>{(e=>{window&&window.addEventListener&&(window.addEventListener("error",t=>{e.error("Global error captured",{action:"window.error",message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error?t.error.toString():void 0})}),window.addEventListener("unhandledrejection",t=>{e.error("Unhandled promise rejection",{action:"window.unhandledrejection",reason:t.reason?t.reason.toString():void 0})}))})(u),u.info("Loading admin interface",{action:"admin.init",traceId:n(),context:s()})},[u]),(0,e.createElement)("div",{className:"ls-admin-app"},(0,e.createElement)("h1",null,_),d?(0,e.createElement)(d,{panel:{name:c,title:m}}):(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,a.__)("No panel available for this screen.","lean-stats")))},null),J)})();