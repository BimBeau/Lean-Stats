(()=>{"use strict";const e=window.React,t=window.wp.element,a=window.wp.i18n,l=window.wp.components;class n extends t.Component{state={error:null};static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){const{onError:a}=this.props;a&&a(e,t)}render(){const{error:t}=this.state,{fatal:n,checkedHandles:s=[],checkedGlobals:r=[],children:i}=this.props,o=n||t;if(o){const t=(o?.checkedHandles||s).filter(Boolean),n=(o?.checkedGlobals||r).filter(Boolean),i=o?.reason||o?.message||("string"==typeof o?o:"");return(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},(0,e.createElement)("p",null,(0,a.__)("Lean Stats cannot load the admin interface.","lean-stats")),i&&(0,e.createElement)("p",null,i),t.length>0&&(0,e.createElement)("p",null,(0,a.sprintf)((0,a.__)("Script handles checked: %s","lean-stats"),t.join(", "))),n.length>0&&(0,e.createElement)("p",null,(0,a.sprintf)((0,a.__)("Global namespaces checked: %s","lean-stats"),n.join(", "))))}return i}}const s=n,r=window.LeanStatsAdmin||null,i=[{name:"dashboard",title:(0,a.__)("Dashboard","lean-stats")},{name:"top-pages",title:(0,a.__)("Pages","lean-stats")},{name:"referrers",title:(0,a.__)("Referring sites","lean-stats")},{name:"search-terms",title:(0,a.__)("Internal searches","lean-stats")},{name:"geolocation",title:(0,a.__)("Geolocation","lean-stats")},{name:"settings",title:(0,a.__)("Settings","lean-stats")}],o={plugin_label:"",respect_dnt_gpc:!0,url_strip_query:!0,url_query_allowlist:[],raw_logs_enabled:!1,raw_logs_retention_days:1,excluded_roles:[],excluded_paths:[],debug_enabled:!1,geo_aggregation_enabled:!0,maxmind_account_id:"",maxmind_license_key:""},c=["7d","30d","90d"],d=[{label:(0,a.__)("7 days","lean-stats"),value:"7d"},{label:(0,a.__)("30 days","lean-stats"),value:"30d"},{label:(0,a.__)("90 days","lean-stats"),value:"90d"}],m=["url","title"],_=()=>`ls-${Math.random().toString(36).slice(2,8)}${Date.now().toString(36).slice(-4)}`,u=()=>{const e=Boolean(window?.chrome&&window.chrome.runtime);return{userAgent:"undefined"==typeof navigator?"":navigator.userAgent||"",hasChromeRuntime:e,suggestion:"Test in private browsing to isolate extensions."}},g=({debugEnabled:e=!1,prefix:t="[LeanStats]"}={})=>{const a=()=>"function"==typeof e?e():e,l=(e,l,n,s=!1)=>{(s||a())&&((e,a,l)=>{const n=`${t} ${a}`;console&&console.groupCollapsed?(console.groupCollapsed(n),console[e](l),console.groupEnd()):console[e](n,l)})(e,l,{time:"undefined"!=typeof performance&&performance.now?Number(performance.now().toFixed(2)):Date.now(),page:"undefined"!=typeof window&&window.location&&window.location.pathname||"",...n})};return{debug:(e,t={})=>l("debug",e,t),info:(e,t={})=>l("info",e,t),warn:(e,t={})=>l("warn",e,t),error:(e,n={})=>{a()?l("error",e,n,!0):console&&console.error&&console.error(`${t} ${e}`)},isDebugEnabled:()=>e}},p=e=>c.includes(e)?e:null,b=e=>m.includes(e)?e:null,h=()=>`lean_stats_range_preset:${r?.currentUserId?String(r.currentUserId):"default"}`,E=()=>`lean_stats_page_label_display:${r?.currentUserId?String(r.currentUserId):"default"}`,y=()=>{const e=(()=>{if("undefined"==typeof window)return null;const e=new URLSearchParams(window.location.search);return p(e.get("period")||e.get("range"))})(),[a,l]=(0,t.useState)(()=>e||(()=>{if("undefined"==typeof window||!window.localStorage)return null;try{return p(window.localStorage.getItem(h()))}catch(e){return null}})()||"30d"),[n,s]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{e&&!n||Boolean(p(a))&&(e=>{if("undefined"!=typeof window&&window.localStorage)try{window.localStorage.setItem(h(),e)}catch(e){}})(a)},[a,e,n]),[a,e=>{l(e),s(!0)}]},w=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,v=e=>{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),l=new Date(a);switch(e){case"7d":l.setDate(l.getDate()-6);break;case"30d":default:l.setDate(l.getDate()-29);break;case"90d":l.setDate(l.getDate()-89)}return{start:w(l),end:w(a)}},f=({value:t,onChange:n})=>(0,e.createElement)(l.Card,{className:"ls-overview__summary-card ls-overview__summary-card--filter"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Period","lean-stats"),value:t,options:d,onChange:n,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}))),N=()=>{var e;return Boolean(null!==(e=window.LEAN_STATS_DEBUG)&&void 0!==e?e:r?.settings?.debugEnabled)},x=(e,t,a)=>{const l=r?.restUrl?`${r.restUrl}`:"",n=new URL(`${null!=a?a:r?.settings?.restInternalNamespace||""}${e}`,l);return t&&Object.entries(t).forEach(([e,t])=>{null!=t&&""!==t&&n.searchParams.set(e,t)}),n.toString()},k=(e,l,n={})=>{const[s,i]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[d,m]=(0,t.useState)(null),u=(0,t.useMemo)(()=>JSON.stringify(null!=l?l:{}),[l]),p=(0,t.useMemo)(()=>g({debugEnabled:N}),[]),{enabled:b=!0,namespace:h=r?.settings?.restInternalNamespace}=n;return(0,t.useEffect)(()=>{if(!b||!e)return c(!1),m(null),void i(null);let t=!0;const n=new AbortController,s=_();return(async()=>{if(!r?.restNonce||!r?.restUrl)return m((0,a.__)("Missing REST configuration.","lean-stats")),void c(!1);c(!0),m(null),p.debug("Loading admin data",{action:"admin.fetch",traceId:s,path:e,params:l});try{const o=await fetch(x(e,l,h),{signal:n.signal,headers:{"X-WP-Nonce":r.restNonce}});if(!o.ok)throw new Error((0,a.sprintf)((0,a.__)("API error (%s)","lean-stats"),o.status));const c=await o.json();t&&i(c),p.debug("Admin data received",{action:"admin.fetch.success",traceId:s,path:e})}catch(l){t&&"AbortError"!==l.name?(m(l.message||(0,a.__)("Loading error.","lean-stats")),p.error("Admin load error",{action:"admin.fetch.error",traceId:s,path:e,error:l?.message})):"AbortError"===l.name&&p.debug("Admin load cancelled",{action:"admin.fetch.abort",traceId:s,path:e})}finally{t&&c(!1)}})(),()=>{t=!1,n.abort()}},[e,u,b]),{data:s,isLoading:o,error:d}},S=["ls-skeleton__bar--w80","ls-skeleton__bar--w74","ls-skeleton__bar--w68","ls-skeleton__bar--w62","ls-skeleton__bar--w56","ls-skeleton__bar--w50"],L=({isLoading:t,error:n,isEmpty:s,emptyLabel:r,loadingLabel:i=(0,a.__)("Loading…","lean-stats"),skeletonRows:o=4})=>{if(t){const t=Array.from({length:o},(e,t)=>t);return(0,e.createElement)("div",{className:"ls-data-state","aria-live":"polite","aria-busy":"true"},(0,e.createElement)("div",{className:"ls-data-state__header"},(0,e.createElement)(l.Spinner,null),(0,e.createElement)("span",null,i)),(0,e.createElement)("div",{className:"ls-skeleton"},t.map(t=>(0,e.createElement)("div",{key:t,className:`ls-skeleton__bar ${S[Math.min(t,S.length-1)]}`}))))}return n?(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},n):s?(0,e.createElement)("p",{role:"status"},r):null},C=({className:e,children:a})=>(0,t.createElement)("div",{className:e},a),$=({title:e,children:a,...n})=>{const s=l.Card||C,r=l.CardHeader||C,i=l.CardBody||C,o={className:["ls-card",n.className].filter(Boolean).join(" ")},c=l.Card?n:o;return(0,t.createElement)(s,c,e?(0,t.createElement)(r,l.CardHeader?void 0:{className:"ls-card__header"},(0,t.createElement)("strong",null,e)):null,(0,t.createElement)(i,l.CardBody?void 0:{className:"ls-card__body"},a))},M=({title:n,labelHeader:s,range:i,endpoint:o,emptyLabel:c,labelFallback:d,metricLabel:m=(0,a.__)("Page views","lean-stats"),metricKey:_="hits",metricValueKey:u="hits",supportsPageLabelToggle:g=!1})=>{const[p,h]=(0,t.useState)(1),[y,w]=(0,t.useState)(10),[v,f]=(0,t.useState)(_),[N,x]=(0,t.useState)("desc"),[S,C]=(()=>{const[e,a]=(0,t.useState)(()=>(()=>{if("undefined"==typeof window||!window.localStorage)return null;try{return b(window.localStorage.getItem(E()))}catch(e){return null}})()||"url");return(0,t.useEffect)(()=>{Boolean(b(e))&&(e=>{if("undefined"!=typeof window&&window.localStorage)try{window.localStorage.setItem(E(),e)}catch(e){}})(e)},[e]),[e,a]})(),M=g&&"title"===S?(0,a.__)("Title","lean-stats"):s,T=g&&"title"===S?"page_title":"label";(0,t.useEffect)(()=>{h(1)},[i.start,i.end]),(0,t.useEffect)(()=>{f(_),x("desc")},[_]),(0,t.useEffect)(()=>{g&&"label"===v&&"page_title"===T&&(f("page_title"),h(1)),g&&"page_title"===v&&"label"===T&&(f("label"),h(1))},[g,v,T]);const{data:D,isLoading:B,error:P}=k(o,{...i,page:p,per_page:y,orderby:v,order:N},{namespace:r?.settings?.restNamespace}),I=D?.items||[],R=D?.pagination||{},A=R.totalPages||1,F=R.totalItems||I.length;(0,t.useEffect)(()=>{!B&&!P&&A&&p>A&&h(A)},[A,p,B,P]);const U=p>1,H=p<A,j="asc"===N?(0,a.__)("Ascending","lean-stats"):(0,a.__)("Descending","lean-stats"),G=`${M} ${(0,a.__)("label","lean-stats")}`
/* translators: %s: current sort order label. */,q=`${(0,a.__)("Toggle sort order","lean-stats")}: ${j}`
/* translators: %s: table title. */,O=`${(0,a.__)("Table","lean-stats")}: ${n}`,K=I.map((e,t)=>{var a;return{key:`${e.label||d}-${t}`,label:e.label||d,pageTitle:e.page_title||"",value:null!==(a=e?.[u])&&void 0!==a?a:0}});return(0,e.createElement)($,{title:n},(0,e.createElement)("div",{className:"ls-table-controls"},(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Sort by","lean-stats"),value:v,options:[{label:m,value:_},{label:G,value:T}],onChange:e=>{f(e),h(1)},__nextHasNoMarginBottom:!0}),g&&(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Display","lean-stats"),value:S,options:[{label:(0,a.__)("URL","lean-stats"),value:"url"},{label:(0,a.__)("Title","lean-stats"),value:"title"}],onChange:e=>{const t=b(e)||"url";C(t),f("title"===t?"page_title":"label"),h(1)},__nextHasNoMarginBottom:!0}),(0,e.createElement)(l.Button,{variant:"secondary",icon:"asc"===N?"arrow-up-alt2":"arrow-down-alt2",onClick:()=>{x("asc"===N?"desc":"asc"),h(1)},"aria-label":q},j),(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Rows","lean-stats"),value:String(y),options:[{label:"5",value:"5"},{label:"10",value:"10"},{label:"20",value:"20"}],onChange:e=>{w(Number(e)),h(1)},__nextHasNoMarginBottom:!0})),(0,e.createElement)(L,{isLoading:B,error:P,isEmpty:!B&&!P&&0===K.length,emptyLabel:c,loadingLabel:`${(0,a.__)("Loading","lean-stats")}: ${n}`}),!B&&!P&&K.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("table",{className:"widefat striped ls-report-table","aria-label":O},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{scope:"col"},M),(0,e.createElement)("th",{scope:"col"},m))),(0,e.createElement)("tbody",null,K.map(t=>(0,e.createElement)("tr",{key:t.key},(0,e.createElement)("td",null,g&&"title"===S?(e=>"string"!=typeof e?"":e.length>40?`${e.slice(0,40)}...`:e)(t.pageTitle||t.label):t.label),(0,e.createElement)("td",null,t.value))))),(0,e.createElement)(l.Flex,{className:"ls-table-pagination",justify:"space-between",align:"center"},(0,e.createElement)(l.FlexItem,null,(0,e.createElement)(l.ButtonGroup,null,(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>h(e=>Math.max(e-1,1)),disabled:!U,"aria-label":(0,a.__)("Previous page","lean-stats")},(0,a.__)("Previous","lean-stats")),(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>h(e=>Math.min(e+1,A)),disabled:!H,"aria-label":(0,a.__)("Next page","lean-stats")},(0,a.__)("Next","lean-stats")))),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},`${(0,a.__)("Page","lean-stats")} ${p} ${(0,a.__)("of","lean-stats")} ${A}`),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},`${F} ${(0,a.__)("items","lean-stats")}`))))},T=({title:a,endpoint:l,labelHeader:n,emptyLabel:s,labelFallback:r,metricLabel:i,metricKey:o,metricValueKey:c,supportsPageLabelToggle:d=!1})=>{const[m,_]=y(),u=(0,t.useMemo)(()=>v(m),[m]);return(0,e.createElement)("div",{className:"ls-report-panel"},(0,e.createElement)("div",{className:"ls-report-panel__header"},(0,e.createElement)(f,{value:m,onChange:_})),(0,e.createElement)(M,{title:a,labelHeader:n,range:u,endpoint:l,emptyLabel:s,labelFallback:r,metricLabel:i,metricKey:o,metricValueKey:c,supportsPageLabelToggle:d}))},D=()=>{const t=[{name:"countries",title:(0,a.__)("Top countries","lean-stats")},{name:"cities",title:(0,a.__)("Top cities","lean-stats")}];return(0,e.createElement)(l.TabPanel,{className:"ls-geolocation-tabs",tabs:t},t=>"countries"===t.name?(0,e.createElement)(T,{title:(0,a.__)("Top countries","lean-stats"),labelHeader:(0,a.__)("Country code","lean-stats"),endpoint:"/geo-countries",emptyLabel:(0,a.__)("No country data available.","lean-stats"),labelFallback:"--"}):"cities"===t.name?(0,e.createElement)(T,{title:(0,a.__)("Top cities","lean-stats"),labelHeader:(0,a.__)("City","lean-stats"),endpoint:"/geo-cities",emptyLabel:(0,a.__)("No city data available.","lean-stats"),labelFallback:(0,a.__)("Unknown","lean-stats")}):null)},B=({range:t})=>{const{data:l,isLoading:n,error:s}=k("/admin/device-split",t),r=(l?.items||[]).map(e=>{const t="desktop"===(e.label?e.label.toLowerCase():"")?(0,a.__)("Desktop","lean-stats"):null;return{...e,label:t||(e.label?e.label.charAt(0).toUpperCase()+e.label.slice(1):(0,a.__)("Unknown","lean-stats"))}}),i=r.reduce((e,t)=>Math.max(e,t.hits),0);return(0,e.createElement)($,{title:(0,a.__)("Device page views","lean-stats")},(0,e.createElement)(L,{isLoading:n,error:s,isEmpty:!n&&!s&&0===r.length,emptyLabel:(0,a.__)("No device data available.","lean-stats"),loadingLabel:(0,a.__)("Loading device breakdown…","lean-stats")}),!n&&!s&&r.length>0&&(0,e.createElement)("div",{className:"ls-device-breakdown"},r.map(t=>{const l=i?Math.round(t.hits/i*100):0;return(0,e.createElement)("div",{key:t.label,className:"ls-device-breakdown__row"},(0,e.createElement)("div",{className:"ls-device-breakdown__label"},t.label),(0,e.createElement)("div",{className:"ls-device-breakdown__bar","aria-hidden":"true"},(0,e.createElement)("div",{className:"ls-device-breakdown__bar-fill",style:{width:`${l}%`}})),(0,e.createElement)("div",{className:"ls-device-breakdown__value"},`${t.hits} ${(0,a._n)("view","views",t.hits,"lean-stats")}`))})))},P=({children:t,status:a="info"})=>(0,e.createElement)("span",{className:`ls-kpi-card__badge ls-kpi-card__badge--${a}`,role:"status"},t),I=({range:t})=>{const{data:n,isLoading:s,error:i}=k("/overview",t,{namespace:r?.settings?.restNamespace}),o=n?.overview||null,c=n?.comparison?.overview||null,d=!s&&!i&&!o;if(s){const t=[{icon:"visibility"},{icon:"chart-bar"},{icon:"admin-links"},{icon:"warning"},{icon:"search"}];return(0,e.createElement)(e.Fragment,null,t.map((t,n)=>(0,e.createElement)(l.Card,{key:`loading-${t.icon}-${n}`,className:"ls-overview__summary-card"},(0,e.createElement)(l.CardBody,{className:"ls-kpi-card__body ls-kpi-card__body--loading"},(0,e.createElement)("div",{className:"ls-kpi-card__content"},(0,e.createElement)("p",{className:"ls-kpi-card__label ls-kpi-card__label--loading"},(0,e.createElement)(l.Spinner,null),(0,e.createElement)("span",null,(0,a.__)("Loading…","lean-stats"))),(0,e.createElement)("span",{className:"ls-kpi-card__value-skeleton","aria-hidden":"true"})),(0,e.createElement)("span",{className:`dashicons dashicons-${t.icon} ls-kpi-card__icon`,"aria-hidden":"true"})))))}if(i||d)return(0,e.createElement)(l.Card,{className:"ls-overview__summary-card ls-overview__summary-card--status"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)(L,{isLoading:s,error:i,isEmpty:d,emptyLabel:(0,a.__)("No overview metrics available.","lean-stats"),loadingLabel:(0,a.__)("Loading KPIs…","lean-stats"),skeletonRows:3})));const m=[{key:"visits",label:(0,a.__)("Visits","lean-stats"),value:o.visits,icon:"visibility",comparison:c?.visits},{key:"pageViews",label:(0,a.__)("Page views","lean-stats"),value:o.pageViews,icon:"chart-bar",comparison:c?.pageViews},{key:"uniqueReferrers",label:(0,a.__)("Referring sites","lean-stats"),value:o.uniqueReferrers,icon:"admin-links",comparison:c?.uniqueReferrers},{key:"notFoundHits",label:(0,a.__)("Pages not found (404)","lean-stats"),value:o.notFoundHits,icon:"warning",comparison:c?.notFoundHits},{key:"searchHits",label:(0,a.__)("Internal searches","lean-stats"),value:o.searchHits,icon:"search",comparison:c?.searchHits}];return(0,e.createElement)(e.Fragment,null,m.map(t=>{const a=Number(t.value)||0,n=(s=a,null==(r=null===t.comparison||void 0===t.comparison?null:Number(t.comparison))?null:0===r?0===s?0:100:(s-r)/r*100);var s,r;const i=(e=>{if(null==e)return null;const t=new Intl.NumberFormat(void 0,{maximumFractionDigits:1,minimumFractionDigits:0,signDisplay:"exceptZero"});return 0===e||Object.is(e,-0)?`${t.format(0)}%`:`${t.format(e)}%`})(n),o=n>0,c=n<0,d=0===n||Object.is(n,-0);return(0,e.createElement)(l.Card,{key:t.key,className:"ls-overview__summary-card"},(0,e.createElement)(l.CardBody,{className:"ls-kpi-card__body"},(0,e.createElement)("div",{className:"ls-kpi-card__content"},(0,e.createElement)("p",{className:"ls-kpi-card__label"},t.label),(0,e.createElement)("p",{className:"ls-kpi-card__value-row"},(0,e.createElement)("span",{className:"ls-kpi-card__value"},a),null!==i&&(0,e.createElement)(P,{status:o?"success":c?"error":d?"warning":"info"},i))),(0,e.createElement)("span",{className:`dashicons dashicons-${t.icon} ls-kpi-card__icon`,"aria-hidden":"true"})))}))},R=({height:a,ariaLabel:l,children:n,onResize:s})=>{const{ref:r,size:i,hasSize:o}=(()=>{const e=(0,t.useRef)(null),[a,l]=(0,t.useState)({width:0,height:0}),n=a.width>0&&a.height>0;return(0,t.useEffect)(()=>{const t=e.current;if(!t)return;const a=()=>{const e=t.getBoundingClientRect(),a={width:Math.round(e.width),height:Math.round(e.height)};l(e=>e.width===a.width&&e.height===a.height?e:a)};let n;return a(),window.ResizeObserver?(n=new ResizeObserver(()=>a()),n.observe(t)):window.addEventListener("resize",a),()=>{n?n.disconnect():window.removeEventListener("resize",a)}},[]),{ref:e,size:a,hasSize:n}})();return(0,t.useEffect)(()=>{o&&s&&s(i)},[o,s,i]),(0,e.createElement)("div",{ref:r,className:"ls-chart-frame","data-height":a,role:"img","aria-label":l},o?n:null)},A=({range:l})=>{var n;const{data:s,isLoading:r,error:i}=k("/admin/timeseries/day",l),o=null!==(n=s?.items)&&void 0!==n?n:[],[c,d]=(0,t.useState)(640),m=(0,t.useMemo)(()=>((e,t=640)=>{const a=e.reduce((e,t)=>Math.max(e,t.hits),0),l=Math.max(Math.round(t),65),n=Math.max(l-64,1),s=Math.max(176,1),r=Math.max(e.length-1,1),i=e.map((e,t)=>({x:32+n*t/r,y:208-(a?e.hits/a*s:0),label:e.bucket,hits:e.hits})),o=((e,t=.2)=>{if(0===e.length)return"";const a=(e,a,l,n=!1)=>{const s=a||e,r=l||e,i=Math.hypot(r.x-s.x,r.y-s.y),o=Math.atan2(r.y-s.y,r.x-s.x)+(n?Math.PI:0),c=i*t;return{x:e.x+Math.cos(o)*c,y:e.y+Math.sin(o)*c}};return e.reduce((e,t,l,n)=>{if(0===l)return`M ${t.x} ${t.y}`;const s=n[l-1],r=n[l+1],i=a(s,n[l-2],t),o=a(t,s,r,!0);return`${e} C ${i.x} ${i.y} ${o.x} ${o.y} ${t.x} ${t.y}`},"")})(i),c=i.length>0?`${o} L ${i[i.length-1].x} 208 L ${i[0].x} 208 Z`:"",d=Math.min(5,e.length),m=new Set;if(d<=1)m.add(0);else{const t=(e.length-1)/(d-1);for(let e=0;e<d;e+=1)m.add(Math.round(e*t))}const _=e.map((e,t)=>m.has(t)?{x:32+n*t/r,label:e.bucket}:null).filter(Boolean),u=Array.from({length:4},(e,t)=>{const l=t/3;return{y:32+s*l,value:Math.round(a*(1-l))}});return{points:i,linePath:o,areaPath:c,maxHits:a,width:l,height:240,padding:32,baselineY:208,xLabels:_,yTicks:u}})(o,c),[o,c]),[_,u]=(0,t.useState)(null),g=(0,t.useCallback)(({width:e})=>{const t=Math.max(Math.round(e),65);d(e=>e===t?e:t)},[]),p=e=>(new Intl.NumberFormat).format(e),b=e=>{const t=new Date(`${e}T00:00:00`);if(Number.isNaN(t.getTime()))return e;const a=(new Intl.DateTimeFormat).resolvedOptions().locale||"",l=/^en(?:-|$)/i.test(a);return new Intl.DateTimeFormat(l?"en-US":void 0,{day:"2-digit",month:"2-digit",year:"2-digit"}).format(t)},h=e=>`${p(e)} ${(0,a._n)("page view","page views",e,"lean-stats")}`,E=(0,t.useCallback)(e=>{if(!m.points.length)return;const t=e.currentTarget.getBoundingClientRect();if(!t.width)return;const a=(e.clientX-t.left)/t.width*m.width;let l=m.points[0],n=Math.abs(l.x-a);m.points.forEach(e=>{const t=Math.abs(e.x-a);t<n&&(l=e,n=t)}),u(e=>e?.label===l.label?e:l)},[m.points,m.width]),y=_?`${b(_.label)} : ${h(_.hits)}`:null,w="ls-timeseries-gradient";return(0,e.createElement)($,{title:(0,a.__)("Daily page views","lean-stats")},(0,e.createElement)(L,{isLoading:r,error:i,isEmpty:!r&&!i&&0===o.length,emptyLabel:(0,a.__)("No data available for this period.","lean-stats"),loadingLabel:(0,a.__)("Loading chart…","lean-stats")}),!r&&!i&&o.length>0&&(0,e.createElement)("div",{className:"ls-timeseries"},(0,e.createElement)(R,{height:240,ariaLabel:(0,a.__)("Daily page views line chart","lean-stats"),onResize:g},(0,e.createElement)("div",{className:"ls-timeseries__chart",onMouseLeave:()=>u(null)},(0,e.createElement)("svg",{viewBox:`0 0 ${m.width} ${m.height}`,width:"100%",height:"100%",preserveAspectRatio:"xMidYMid meet",className:"ls-timeseries__svg",role:"img","aria-label":(0,a.__)("Daily page views line chart","lean-stats"),onMouseMove:E},(0,e.createElement)("defs",null,(0,e.createElement)("linearGradient",{id:w,x1:"0",y1:"0",x2:"0",y2:"1"},(0,e.createElement)("stop",{offset:"0%",stopColor:"var(--ls-text-2, #2271b1)",stopOpacity:"0.5"}),(0,e.createElement)("stop",{offset:"100%",stopColor:"var(--ls-text-2, #2271b1)",stopOpacity:"0"}))),(0,e.createElement)("rect",{x:"0",y:"0",width:m.width,height:m.height,className:"ls-timeseries__bg"}),m.yTicks.map(t=>(0,e.createElement)("g",{key:`tick-${t.value}-${t.y}`},(0,e.createElement)("line",{x1:m.padding,y1:t.y,x2:m.width-m.padding,y2:t.y,className:"ls-timeseries__grid-line"}),(0,e.createElement)("text",{x:m.padding-8,y:t.y+4,textAnchor:"end",className:"ls-timeseries__axis-label ls-timeseries__axis-label--y"},p(t.value)))),(0,e.createElement)("line",{x1:m.padding,y1:m.padding,x2:m.padding,y2:m.height-m.padding,className:"ls-timeseries__axis"}),(0,e.createElement)("line",{x1:m.padding,y1:m.height-m.padding,x2:m.width-m.padding,y2:m.height-m.padding,className:"ls-timeseries__axis"}),(0,e.createElement)("path",{d:m.areaPath,className:"ls-timeseries__area",fill:`url(#${w})`}),(0,e.createElement)("path",{d:m.linePath,className:"ls-timeseries__line"}),m.xLabels.map(t=>(0,e.createElement)("text",{key:`label-${t.label}`,x:t.x,y:m.height-m.padding+18,textAnchor:"middle",className:"ls-timeseries__axis-label"},(e=>{const t=new Date(`${e}T00:00:00`);return Number.isNaN(t.getTime())?e:new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short"}).format(t)})(t.label))),m.points.map(t=>(0,e.createElement)("circle",{key:`${t.label}-${t.hits}`,cx:t.x,cy:t.y,r:"4",className:"ls-timeseries__point"+(_?.label===t.label?" is-active":""),onMouseEnter:()=>u(t),onFocus:()=>u(t),onBlur:()=>u(null),tabIndex:"0"},(0,e.createElement)("title",null,`${b(t.label)} : ${h(t.hits)}`)))),_&&(0,e.createElement)("div",{key:`${_.label}-${_.hits}`,className:"ls-timeseries__tooltip",role:"status",style:{left:_.x/m.width*100+"%",top:`calc(${_.y/m.height*100}% - 3px)`}},y)))))},F=()=>{const[l,n]=y(),s=(0,t.useMemo)(()=>v(l),[l]);return(0,e.createElement)("div",{className:"ls-overview"},(0,e.createElement)("div",{className:"ls-overview__summary"},(0,e.createElement)(f,{value:l,onChange:n}),(0,e.createElement)(I,{range:s})),(0,e.createElement)(A,{range:s}),(0,e.createElement)("div",{className:"ls-overview__grid"},(0,e.createElement)(M,{title:(0,a.__)("Pages","lean-stats"),labelHeader:(0,a.__)("Url","lean-stats"),range:s,endpoint:"/top-pages",emptyLabel:(0,a.__)("No popular pages available.","lean-stats"),labelFallback:"/",supportsPageLabelToggle:!0}),(0,e.createElement)(M,{title:(0,a.__)("Top referrers","lean-stats"),labelHeader:(0,a.__)("Referrer","lean-stats"),range:s,endpoint:"/referrers",emptyLabel:(0,a.__)("No referrers available.","lean-stats"),labelFallback:(0,a.__)("Direct","lean-stats")}),(0,e.createElement)(B,{range:s})))},U=({range:n})=>{const[s,i]=(0,t.useState)(1),[o,c]=(0,t.useState)(10),[d,m]=(0,t.useState)("hits"),[_,u]=(0,t.useState)("desc");(0,t.useEffect)(()=>{i(1)},[n.start,n.end]);const{data:g,isLoading:p,error:b}=k("/referrer-sources",{...n,page:s,per_page:o,orderby:d,order:_},{namespace:r?.settings?.restNamespace}),h=g?.items||[],E=g?.pagination||{},y=E.totalPages||1,w=E.totalItems||h.length;(0,t.useEffect)(()=>{!p&&!b&&y&&s>y&&i(y)},[y,s,p,b]);const v=s>1,f=s<y,N="asc"===_?(0,a.__)("Ascending","lean-stats"):(0,a.__)("Descending","lean-stats"),x=`${(0,a.__)("Toggle sort order","lean-stats")}: ${N}`,S=(0,a.__)("Table: Referrer sources","lean-stats"),C=h.map((e,t)=>{const l=e.referrer_domain||(0,a.__)("Direct","lean-stats"),n=e.referrer_domain?(0,a.__)("Referrer","lean-stats"):(0,a.__)("Direct","lean-stats");return{key:`${l}-${e.source_category||n}-${t}`,referrer:l,category:e.source_category||n,hits:e.hits}});return(0,e.createElement)($,{title:(0,a.__)("Referrer sources","lean-stats")},(0,e.createElement)("div",{className:"ls-table-controls"},(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Sort by","lean-stats"),value:d,options:[{label:(0,a.__)("Page views","lean-stats"),value:"hits"},{label:(0,a.__)("Referrer","lean-stats"),value:"referrer"},{label:(0,a.__)("Source category","lean-stats"),value:"category"}],onChange:e=>{m(e),i(1)},__nextHasNoMarginBottom:!0}),(0,e.createElement)(l.Button,{variant:"secondary",icon:"asc"===_?"arrow-up-alt2":"arrow-down-alt2",onClick:()=>{u("asc"===_?"desc":"asc"),i(1)},"aria-label":x},N),(0,e.createElement)(l.SelectControl,{label:(0,a.__)("Rows","lean-stats"),value:String(o),options:[{label:"5",value:"5"},{label:"10",value:"10"},{label:"20",value:"20"}],onChange:e=>{c(Number(e)),i(1)},__nextHasNoMarginBottom:!0})),(0,e.createElement)(L,{isLoading:p,error:b,isEmpty:!p&&!b&&0===C.length,emptyLabel:(0,a.__)("No referrer data available.","lean-stats"),loadingLabel:(0,a.__)("Loading referrer sources…","lean-stats")}),!p&&!b&&C.length>0&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("table",{className:"widefat striped ls-report-table","aria-label":S},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{scope:"col"},(0,a.__)("Referrer","lean-stats")),(0,e.createElement)("th",{scope:"col"},(0,a.__)("Source category","lean-stats")),(0,e.createElement)("th",{scope:"col"},(0,a.__)("Page views","lean-stats")))),(0,e.createElement)("tbody",null,C.map(t=>(0,e.createElement)("tr",{key:t.key},(0,e.createElement)("td",null,t.referrer),(0,e.createElement)("td",null,t.category),(0,e.createElement)("td",null,t.hits))))),(0,e.createElement)(l.Flex,{className:"ls-table-pagination",justify:"space-between",align:"center"},(0,e.createElement)(l.FlexItem,null,(0,e.createElement)(l.ButtonGroup,null,(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>i(e=>Math.max(e-1,1)),disabled:!v,"aria-label":(0,a.__)("Previous page","lean-stats")},(0,a.__)("Previous","lean-stats")),(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>i(e=>Math.min(e+1,y)),disabled:!f,"aria-label":(0,a.__)("Next page","lean-stats")},(0,a.__)("Next","lean-stats")))),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},`${(0,a.__)("Page","lean-stats")} ${s} ${(0,a.__)("of","lean-stats")} ${y}`),(0,e.createElement)(l.FlexItem,{className:"ls-table-pagination__meta"},`${w} ${(0,a.__)("items","lean-stats")}`))))},H=()=>{const[a,l]=y(),n=(0,t.useMemo)(()=>v(a),[a]);return(0,e.createElement)("div",{className:"ls-report-panel"},(0,e.createElement)("div",{className:"ls-report-panel__header"},(0,e.createElement)(f,{value:a,onChange:l})),(0,e.createElement)(U,{range:n}))},j=()=>(0,e.createElement)(T,{title:(0,a.__)("Search terms","lean-stats"),labelHeader:(0,a.__)("Search term","lean-stats"),endpoint:"/search-terms",emptyLabel:(0,a.__)("No search terms available.","lean-stats"),labelFallback:(0,a.__)("Unknown","lean-stats")});var G;const q=Boolean(null!==(G=window.LEAN_STATS_DEBUG)&&void 0!==G?G:r?.settings?.debugEnabled),O=e=>{const t={...o,...e||{}},a=Boolean(t.debug_enabled||t.raw_logs_enabled);return{...t,debug_enabled:a,raw_logs_enabled:a}},K=({debugEnabled:t})=>{const{data:n,isLoading:s,error:r}=k("/admin/raw-logs",{limit:50},{enabled:t}),i=n?.items||[];return t?(0,e.createElement)("div",{className:"ls-settings-logs"},(0,e.createElement)(L,{isLoading:s,error:r,isEmpty:!s&&!r&&0===i.length,emptyLabel:(0,a.__)("No raw logs available.","lean-stats"),loadingLabel:(0,a.__)("Loading raw logs…","lean-stats"),skeletonRows:4}),!s&&!r&&i.length>0&&(0,e.createElement)("table",{className:"widefat striped ls-settings-logs__table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("Date","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Page","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Referrer","lean-stats")),(0,e.createElement)("th",null,(0,a.__)("Device","lean-stats")))),(0,e.createElement)("tbody",null,i.map((t,l)=>{return(0,e.createElement)("tr",{key:`${t.timestamp_bucket}-${l}`},(0,e.createElement)("td",null,(n=t.timestamp_bucket)?new Date(1e3*n).toLocaleString():""),(0,e.createElement)("td",null,t.page_path),(0,e.createElement)("td",null,t.referrer_domain||(0,a.__)("Direct","lean-stats")),(0,e.createElement)("td",null,t.device_class||"-"));var n})))):(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,a.__)("Enable debug mode to display raw logs.","lean-stats"))},z=()=>{const{data:n,isLoading:s,error:i}=k("/admin/settings"),[c,d]=(0,t.useState)(o),[m,u]=(0,t.useState)(""),[p,b]=(0,t.useState)(""),[h,E]=(0,t.useState)(!1),[y,w]=(0,t.useState)(null),[v,f]=(0,t.useState)({}),[N,S]=(0,t.useState)(!1),[C,M]=(0,t.useState)(!1),[T,D]=(0,t.useState)(null),B=(0,t.useMemo)(()=>g({debugEnabled:q}),[]),P=Boolean(c.debug_enabled);(0,t.useEffect)(()=>{if(n?.settings){const e=O(n.settings);d(e),u(e.url_query_allowlist.join(", ")),b(e.excluded_paths.join("\n")),window.LEAN_STATS_DEBUG=Boolean(e.debug_enabled),f({})}},[n]);const I=async()=>{if(!r?.restNonce||!r?.restUrl)return void w({status:"error",message:(0,a.__)("Missing REST configuration.","lean-stats")});const e=(e=>{if(!e.geo_aggregation_enabled)return{};const t={},l=String(e.maxmind_account_id||"").trim(),n=String(e.maxmind_license_key||"").trim();return l?/^\d+$/.test(l)||(t.maxmind_account_id=(0,a.__)("MaxMind Account ID must be numeric.","lean-stats")):t.maxmind_account_id=(0,a.__)("MaxMind Account ID is required.","lean-stats"),n||(t.maxmind_license_key=(0,a.__)("MaxMind License Key is required.","lean-stats")),t})(c);if(Object.keys(e).length>0)return f(e),void w({status:"error",message:Object.values(e).join(" ")});E(!0),w(null);const t=_();B.info("Saving settings",{action:"settings.save",traceId:t});try{const e=await fetch(x("/admin/settings"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":r.restNonce},body:JSON.stringify(c)}),l=await e.json().catch(()=>null);if(!e.ok)throw l?.data?.field_errors&&f(l.data.field_errors),new Error(l?.message||`${(0,a.__)("API error","lean-stats")} (${e.status})`);if(l?.settings){const e=O(l.settings);d(e),u(e.url_query_allowlist.join(", ")),b(e.excluded_paths.join("\n")),window.LEAN_STATS_DEBUG=Boolean(e.debug_enabled),f({})}w({status:"success",message:(0,a.__)("Settings saved.","lean-stats")}),B.info("Settings saved",{action:"settings.save.success",traceId:t})}catch(e){w({status:"error",message:e.message||(0,a.__)("Error while saving.","lean-stats")}),B.error("Settings save error",{action:"settings.save.error",traceId:t,error:e?.message})}finally{E(!1)}},R=async()=>{if(!r?.restNonce||!r?.restUrl)return void D({status:"error",message:(0,a.__)("Missing REST configuration.","lean-stats")});M(!0),D(null);const e=_();B.info("Purging analytics data",{action:"settings.purge",traceId:e});try{const t=await fetch(x("/admin/purge-data"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":r.restNonce}});if(!t.ok)throw new Error(`${(0,a.__)("API error","lean-stats")} (${t.status})`);await t.json(),D({status:"success",message:(0,a.__)("Analytics data purged.","lean-stats")}),B.info("Analytics data purged",{action:"settings.purge.success",traceId:e})}catch(t){D({status:"error",message:t.message||(0,a.__)("Error while purging.","lean-stats")}),B.error("Purge error",{action:"settings.purge.error",traceId:e,error:t?.message})}finally{M(!1),S(!1)}},A=r?.roles||[],F=[{name:"general",title:(0,a.__)("General","lean-stats")},...P?[{name:"logs",title:(0,a.__)("Logs","lean-stats")}]:[]];return(0,e.createElement)($,{title:(0,a.__)("Settings","lean-stats")},(0,e.createElement)(L,{isLoading:s,error:i,isEmpty:!1,emptyLabel:"",loadingLabel:(0,a.__)("Loading settings…","lean-stats"),skeletonRows:6}),!s&&!i&&(0,e.createElement)(l.TabPanel,{tabs:F},t=>"logs"===t.name?(0,e.createElement)(K,{debugEnabled:P}):(0,e.createElement)("div",{className:"ls-settings-form"},y&&(0,e.createElement)(l.Notice,{status:y.status,isDismissible:!1},y.message),T&&(0,e.createElement)(l.Notice,{status:T.status,isDismissible:!1},T.message),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("General","lean-stats")),(0,e.createElement)(l.TextControl,{label:(0,a.__)("Plugin name (menu and dashboard)","lean-stats"),help:(0,a.__)('Leave blank to use "Lean Stats".',"lean-stats"),value:c.plugin_label,onChange:e=>d(t=>({...t,plugin_label:e}))}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Geolocation","lean-stats")),(0,e.createElement)("p",null,(0,a.__)("Geolocation aggregation requires MaxMind GeoLite credentials.","lean-stats")),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Enable geolocation aggregation","lean-stats"),help:(0,a.__)("Aggregates country, region, and city data in analytics dashboards.","lean-stats"),checked:Boolean(c.geo_aggregation_enabled),onChange:e=>{d(t=>({...t,geo_aggregation_enabled:e})),e||f(e=>({...e,maxmind_account_id:null,maxmind_license_key:null}))}}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("MaxMind Account ID","lean-stats"),type:"text",disabled:!c.geo_aggregation_enabled,help:v.maxmind_account_id||(0,a.__)("Numeric Account ID for MaxMind IP geolocation.","lean-stats"),value:c.maxmind_account_id,onChange:e=>{d(t=>({...t,maxmind_account_id:e})),v.maxmind_account_id&&f(e=>({...e,maxmind_account_id:null}))},isInvalid:Boolean(v.maxmind_account_id)}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("MaxMind License Key","lean-stats"),type:"password",disabled:!c.geo_aggregation_enabled,help:v.maxmind_license_key||(0,a.__)("License Key for MaxMind IP geolocation.","lean-stats"),value:c.maxmind_license_key,onChange:e=>{d(t=>({...t,maxmind_license_key:e})),v.maxmind_license_key&&f(e=>({...e,maxmind_license_key:null}))},isInvalid:Boolean(v.maxmind_license_key)}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Privacy & consent","lean-stats")),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Respect DNT / GPC","lean-stats"),help:(0,a.__)("Ignore tracking if the browser sends DNT or GPC.","lean-stats"),checked:c.respect_dnt_gpc,onChange:e=>d(t=>({...t,respect_dnt_gpc:e}))}),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Debug mode","lean-stats"),help:(0,a.__)("Enables detailed console logs and raw log capture.","lean-stats"),checked:c.debug_enabled,onChange:e=>d(t=>({...t,debug_enabled:e,raw_logs_enabled:e}))}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("Retention window (days)","lean-stats"),type:"number",min:1,max:365,value:String(c.raw_logs_retention_days),help:(0,a.__)("Raw logs purge automatically after the configured window.","lean-stats"),onChange:e=>{const t=Number.parseInt(e,10);d(e=>({...e,raw_logs_retention_days:Number.isNaN(t)?e.raw_logs_retention_days:t}))}}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("URL cleaning","lean-stats")),(0,e.createElement)(l.ToggleControl,{label:(0,a.__)("Strip query parameters","lean-stats"),help:(0,a.__)("Remove query parameters from tracked URLs.","lean-stats"),checked:c.url_strip_query,onChange:e=>d(t=>({...t,url_strip_query:e}))}),(0,e.createElement)(l.TextControl,{label:(0,a.__)("Query parameter allowlist","lean-stats"),help:(0,a.__)("Comma-separated list of allowed query keys (used for URL tracking and UTM aggregation).","lean-stats"),value:m,onChange:e=>{u(e);const t=e.split(",").map(e=>e.trim()).filter(Boolean);d(e=>({...e,url_query_allowlist:t}))}}))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Exclusions","lean-stats")),(0,e.createElement)(l.TextareaControl,{label:(0,a.__)("Excluded paths","lean-stats"),help:(0,a.__)("One per line or comma-separated (e.g., /privacy, /account).","lean-stats"),value:p,onChange:e=>{b(e);const t=e.split(/[\n,]+/).map(e=>e.trim()).filter(Boolean);d(e=>({...e,excluded_paths:t}))}}),(0,e.createElement)("div",null,(0,e.createElement)("p",{className:"ls-settings-roles__title"},(0,a.__)("Role exclusions","lean-stats")),(0,e.createElement)("p",null,(0,a.__)("Select roles to exclude from tracking. Select all roles to ignore all logged-in users.","lean-stats")),(0,e.createElement)("div",{className:"ls-settings-roles__list"},0===A.length&&(0,e.createElement)("p",null,(0,a.__)("No roles available.","lean-stats")),A.map(t=>(0,e.createElement)(l.CheckboxControl,{key:t.key,label:t.label,checked:c.excluded_roles.includes(t.key),onChange:e=>{d(a=>{const l=new Set(a.excluded_roles);return e?l.add(t.key):l.delete(t.key),{...a,excluded_roles:Array.from(l)}})}})))))),(0,e.createElement)(l.Card,{className:"ls-settings-section"},(0,e.createElement)(l.CardBody,null,(0,e.createElement)("h3",{className:"ls-settings-section__title"},(0,a.__)("Data management","lean-stats")),(0,e.createElement)("p",null,(0,a.__)("Remove all aggregated analytics and raw log entries.","lean-stats")),(0,e.createElement)(l.Button,{variant:"secondary",isDestructive:!0,onClick:()=>S(!0)},(0,a.__)("Purge analytics data","lean-stats")))),(0,e.createElement)(l.Button,{variant:"primary",isBusy:h,onClick:I,"aria-label":(0,a.__)("Save settings","lean-stats")},(0,a.__)("Save","lean-stats")),N&&(0,e.createElement)(l.Modal,{title:(0,a.__)("Confirm data purge","lean-stats"),onRequestClose:()=>S(!1)},(0,e.createElement)("p",null,(0,a.__)("This action permanently removes all stored analytics and raw logs. Settings remain unchanged.","lean-stats")),(0,e.createElement)("div",{className:"ls-settings-modal__actions"},(0,e.createElement)(l.Button,{variant:"secondary",onClick:()=>S(!1)},(0,a.__)("Cancel","lean-stats")),(0,e.createElement)(l.Button,{variant:"primary",isDestructive:!0,isBusy:C,onClick:R},(0,a.__)("Purge now","lean-stats")))))))},V=()=>(0,e.createElement)(T,{title:(0,a.__)("Top pages","lean-stats"),labelHeader:(0,a.__)("Url","lean-stats"),endpoint:"/top-pages",emptyLabel:(0,a.__)("No popular pages available.","lean-stats"),labelFallback:"/",supportsPageLabelToggle:!0}),X=()=>(0,e.createElement)(T,{title:(0,a.__)("Top 404s","lean-stats"),labelHeader:(0,a.__)("Url","lean-stats"),endpoint:"/404s",emptyLabel:(0,a.__)("No missing pages available.","lean-stats"),labelFallback:"/"}),Y=()=>(0,e.createElement)(T,{title:(0,a.__)("Entry pages (approx.)","lean-stats"),labelHeader:(0,a.__)("Url","lean-stats"),endpoint:"/entry-pages",emptyLabel:(0,a.__)("No entry pages available.","lean-stats"),labelFallback:"/",metricLabel:(0,a.__)("Entries (approx.)","lean-stats"),metricKey:"entries",metricValueKey:"entries",supportsPageLabelToggle:!0}),W=()=>(0,e.createElement)(T,{title:(0,a.__)("Exit pages (approx.)","lean-stats"),labelHeader:(0,a.__)("Url","lean-stats"),endpoint:"/exit-pages",emptyLabel:(0,a.__)("No exit pages available.","lean-stats"),labelFallback:"/",metricLabel:(0,a.__)("Exits (approx.)","lean-stats"),metricKey:"exits",metricValueKey:"exits",supportsPageLabelToggle:!0}),J=()=>{const t=[{name:"top-pages",title:(0,a.__)("Top pages","lean-stats")},{name:"entry-pages",title:(0,a.__)("Entry pages","lean-stats")},{name:"exit-pages",title:(0,a.__)("Exit pages","lean-stats")},{name:"not-found",title:(0,a.__)("Pages not found (404)","lean-stats")}];return(0,e.createElement)(l.TabPanel,{className:"ls-pages-tabs",tabs:t},t=>"entry-pages"===t.name?(0,e.createElement)(Y,null):"exit-pages"===t.name?(0,e.createElement)(W,null):"not-found"===t.name?(0,e.createElement)(X,null):(0,e.createElement)(V,null))},Z=document.getElementById("lean-stats-admin");Z&&(0,t.render)((0,e.createElement)(s,null,(0,e.createElement)(()=>{var n;const s=Boolean(null!==(n=window.LEAN_STATS_DEBUG)&&void 0!==n?n:r?.settings?.debugEnabled),o=(0,t.useMemo)(()=>g({debugEnabled:s}),[s]),c=(e=>{if(!Array.isArray(e))return i;const t=e.map(e=>({name:e?.name||"",title:e?.title||e?.name||""})).filter(e=>e.name);return t.length>0?t:i})(r?.panels),d=r?.currentPanel||"dashboard",m=(e=>{const t={dashboard:F,"top-pages":J,referrers:H,"search-terms":j,geolocation:D,settings:z};return t[e]?t[e]:(window.LeanStatsAdminPanels||{})[e]||null})(d),p=((e,t)=>{const l=t.find(t=>t.name===e);return l?.title||(0,a.__)("Lean Stats","lean-stats")})(d,c),b=r?.settings?.pluginLabel||(0,a.__)("Lean Stats","lean-stats");return(0,t.useEffect)(()=>{(e=>{window&&window.addEventListener&&(window.addEventListener("error",t=>{e.error("Global error captured",{action:"window.error",message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error?t.error.toString():void 0})}),window.addEventListener("unhandledrejection",t=>{e.error("Unhandled promise rejection",{action:"window.unhandledrejection",reason:t.reason?t.reason.toString():void 0})}))})(o),o.info("Loading admin interface",{action:"admin.init",traceId:_(),context:u()})},[o]),r?(0,e.createElement)("div",{className:"ls-admin-app"},(0,e.createElement)("h1",null,b),m?(0,e.createElement)(m,{panel:{name:d,title:p}}):(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,a.__)("No panel available for this screen.","lean-stats"))):(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},(0,a.__)("Missing admin configuration.","lean-stats"))},null)),Z)})();